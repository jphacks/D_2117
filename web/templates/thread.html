{% extends "common.html" %}
{% block title %}タイムライン{% endblock %}
{% block header %}タイムライン{% endblock %}
{% block main %}
  {% macro render_error(field) %}
    <ul class=errors>
      {% for error in field.errors %}
        <font color='red'>{{ error }}</font>
      {% endfor %}
    </ul>
  {% endmacro %}
  <div class="card-decks container-">
      <div class="card border-secondary bg-white mb-3 rounded">
          <div class="card-header h3">
              {% if reply_id == 0 %}
                使い方
              {% else %}
                <img src="static/images/{{threadtop.img_source}}.jpg" height="500">
              {% endif %}
          </div>
          <div class="card-body">
              <div style="white-space:pre-wrap;">{{threadtop.message}}</div><br>
          </div>
      </div>
  </div>
  {% if current_user.is_authenticated %}
  <div class="card-decks container-">
    <div class="card border-secondary bg-white mb-3 rounded">
        <div class="card-header h3">
          {% if reply_id == 0 %}
            新規
          {% else %}
            返信
          {% endif %}
        </div>
        <div class="card-body">
          <form id="threadsubmissionform" method="post" enctype="multipart/form-data" >  
              {{ form.csrf_token }}
              <div class="table-responsive">  
              <table class="table table-bordered">
                <tbody>
                  <tr>
                    <th><label class="form-label ">メッセージ</label></th>
                    <td>{{ form.message(rows='5', cols='30') }}{{ render_error(form.message) }}</td>
                  </tr>
                  {% if reply_id == 0 %}
                  <tr>
                    <th><label class="form-label">ペットの画像</label></th>
                    <td>{{ form.img }}{{ render_error(form.img) }}</td>
                  </tr>
                  <tr>
                    <th><label class="form-label ">画像に写っているペットの名前</label><br>(※先に<a href="/petInfo">ペットを登録</a>してください)</th>
                    <td>{{ form.pet_id }}{{ render_error(form.pet_id) }}</td>
                  </tr>
                  {% endif %}
                  <tr>
                    <td colspan="2">{{ form.sub }}</td>
                  </tr>
                </tbody>
              </table>
              </div>
          </form>
        </div>
      </div>
    </div>
    {% endif %}
    {% for thread in threadlist %}
        <div class="card-decks container-">
            <div class="card border-secondary bg-white mb-3 rounded">
                <div class="card-header h3">
                    <img src="static/images/{{thread.img_source}}.jpg" height="500">
                </div>
                <div class="card-body">
                    <div style="white-space:pre-wrap;">{{thread.message}}</div><br>
                    <a href="/{{thread.thread_id}}">返信</a>
                </div>
            </div>
        </div>
    {% endfor %}
{% endblock %}